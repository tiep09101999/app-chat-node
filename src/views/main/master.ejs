<!DOCTYPE html>
<html lang="en">
<head>
    <title>Awesome Chat</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" href="images/logo_favicon/favicon-trungquandev.png" />
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="bower_components/AlertifyJS/build/css/alertify.css">
    <link rel="stylesheet" href="bower_components/emojionearea/dist/emojionearea.min.css">
    <link rel="stylesheet" href="bower_components/photoset-grid/css/colorbox.css">
    <link rel="stylesheet" href="bower_components/emojione/extras/css/emojione.min.css">
    <link rel="stylesheet" href="bower_components/emojione/extras/css/emojione-awesome.css">

    <link rel="stylesheet" href="css/style.css">
</head>
<body onload="spinLoaded()">
    <!--Icon loader-->
    <div id="loader"></div>
    
   
    <% if(success != "") { %>
        <% success.forEach((item) => { %>
           
            <div class="master-success-message alert alert-success"><%- item %></div>
        <% }); %>
    <% } %>
    <!-- include('navbar'); -->
    <nav class="navbar navbar-inverse no-margin-bottom">
        <div class="container-fluid">
            <div class="navbar-header col-sm-3 navbar-left">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>                        
                </button>
                <a class="navbar-brand" href="https://trungquandev.com/" target="__blank">
                    <img src="images/logo_favicon/soict_25_years.png" style=" height: 50px; " alt="logo-trungquandev">
                </a>
            </div>
            <div class="col-sm-3 no-padding">
                <ul class="nav navbar-nav navbar-left no-padding-start">
                    <li>
                        <input type="text" name="search" class="searchBox" placeholder="Tìm kiếm tên cuộc trò chuyện">
                        <div id="search-results">
                            <h3>Kết quả</h3>
                            <div class="search_content">
                                <ul></ul>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="collapse navbar-collapse col-sm-6 navbar-right" id="myNavbar">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/" title="Trang chủ">
                            <i class="fa fa-home"></i>
                        </a>
                    </li>
                    <li>
                        <a href="#contactsModal" data-toggle="modal" title="Quản lý liên lạc" id="show-modal-contacts">
                            <i class="fa fa-user-plus"></i>
                            <% if( (countAllContactsReceiveds + countAllContactsSents) >0) { %>
                                <div class="noti_contact_counter">
                                    <%= (countAllContactsReceiveds + countAllContactsSents) %>
                                </div>
                            <% } else { %>
                                <div class="noti_contact_counter display"></div>
                            <%  } %>
                            
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0)" id="noti_Button" data-toggle="modal" title="Thông báo">
                            <i class="fa fa-globe"></i>
                            <% if(countNotifUnreads >0) { %>
                                <div class="noti_counter" >
                                    <%= countNotifUnreads %>
                                </div>
                            <% } else { %>
                                <div class="noti_counter display" ></div>
                            <%  } %>
                            <div id="noti_Container">
                                <div id="notifications">
                                    <a href="javascript:void(0)" id="popup-mark-notif-as-read">Đánh dấu tất cả là đã đọc</a>
                                    <div class="noti_content">
                                       <% notifications.forEach((e) => {  %>
                                           <%- e %>
                                       <% }); %>
                                    </div>
                                    <div class="seeAll"><a href="#">Xem tất cả</a></div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="dropdown" id="dropdown-navbar-user" data-uid="user._id">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                            <img class="avatar-small" id="navbar-avatar" src="images/users/<%= user.avatar %>" alt="">
                            <span id="navbar-username"> <%= user.username %> </span>
                            
                            <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="#user-profile-modal" data-toggle="modal">
                                    <i class="fa fa-cog"></i>
                                    &nbsp;Cài đặt tài khoản
                                </a>
                            </li>
                            <li>
                                <a href="/logout">
                                    <i class="fa fa-sign-out"></i>
                                    &nbsp;Đăng xuất
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <!-- content -->
    <div class="container-fluid">
        <div class="row content">
            <!-- include('sections/leftSidenav'); -->
            <div class="col-sm-3 sidenav no-padding">
                <div class="left">
                    <div class="top form-group">
                        <select class="form-control" id="select-type-chat">
                            <option data-target="#all-chat" value="all-chat">Toàn bộ trò chuyện</option>
                            <option data-target="#user-chat" value="user-chat">Trò chuyện cá nhân</option>
                            <option data-target="#group-chat" value="group-chat">Trò chuyện nhóm</option>
                        </select>
                        <a href="#groupChatModal" class="create-group-chat" data-toggle="modal" 
                            title="Tạo một nhóm trò chuyện mới"></a>
                    </div>
                    <div class='tab-content'>
                        <div class="tab-pane active" id="all-chat">
                            <ul class="people no-padding-start">
                            <% getAllConversationWithMessages.forEach(function(e){ %>
                                <% if(e.members) { %>
                                    <a href="#uid_<%= e._id %>" data-target="#to_<%= e._id %>" class="room-chat">
                                        <li class="person group-chat" data-chat="<%= e._id %>">
                                            <div class="left-avatar">
                                                <!-- <div class="dot"></div> -->
                                                <img src="images/users/group-avatar-trungquandev.png" alt="">
                                            </div>
                                            <span class="name">
                                                <span class="group-chat-name">Group:</span> <%= e.name %>
                                            </span>
                                            <span class="time">
                                                <%= convertTime(getLastItem(e.messages).createdAt) %>
                                            </span>
                                            <span class="preview convert-emoji">
                                                <% if(getLastItem(e.messages).messageType==="text") { %>
                                                    <%= getLastItem(e.messages).text %>
                                                <% } %>
                                                <% if(getLastItem(e.messages).messageType==="image") { %>
                                                    Đã gửi một ảnh
                                                <% } %>
                                                <% if(getLastItem(e.messages).messageType==="file") { %>
                                                    Đã gửi một tệp đính kèm
                                                <% } %>
                                            </span>
                                        </li>
                                    </a>
                                <% } else { %>
                                    <a href="#uid_<%= e._id %>" class="room-chat" data-target="#to_<%= e._id %>" >
                                        <li class="person " data-chat="<%= e._id %>">
                                            <div class="left-avatar">
                                                <div class="dot"></div>
                                                <img src="images/users/<%= e.avatar %>" alt="">
                                            </div>
                                            <span class="name">
                                                <%= e.username %>
                                            </span>
                                            <span class="time">
                                                <%= convertTime(getLastItem(e.messages).createdAt) %>
                                            </span>
                                            <span class="preview convert-emoji">
                                                <% if(getLastItem(e.messages).messageType==="text") { %>
                                                    <%= getLastItem(e.messages).text %>
                                                <% } %>
                                                <% if(getLastItem(e.messages).messageType==="image") { %>
                                                    Đã gửi một ảnh
                                                <% } %>
                                                <% if(getLastItem(e.messages).messageType==="file") { %>
                                                    Đã gửi một tệp đính kèm
                                                <% } %>
                                            </span>
                                        </li>
                                    </a>
                                <% } %>
                            <% }); %>
                            </ul>
                        </div>
                        <div class="tab-pane" id="user-chat">
                            <ul class="people no-padding-start">
                                <% getAllConversationWithMessages.forEach(function(e){ %>
                                    <% if(!e.members) { %>
                                        <a href="#uid_<%= e._id %>" class="room-chat" data-target="#to_<%= e._id %>" >
                                            <li class="person" data-chat="<%= e._id %>">
                                                <div class="left-avatar">
                                                    <div class="dot"></div>
                                                    <img src="images/users/<%= e.avatar %>" alt="">
                                                </div>
                                                <span class="name">
                                                    <%= e.username %>
                                                </span>
                                                <span class="time">
                                                    <%= convertTime(getLastItem(e.messages).createdAt) %>
                                                </span>
                                                <span class="preview convert-emoji">
                                                    <% if(getLastItem(e.messages).messageType==="text") { %>
                                                        <%= getLastItem(e.messages).text %>
                                                    <% } %>
                                                    <% if(getLastItem(e.messages).messageType==="image") { %>
                                                        Đã gửi một ảnh
                                                    <% } %>
                                                    <% if(getLastItem(e.messages).messageType==="file") { %>
                                                        Đã gửi một tệp đính kèm
                                                    <% } %>
                                                </span>
                                            </li>
                                        </a>
                                    <% } %>
                                <% }); %>
                            </ul>
                        </div>
                        <div class="tab-pane" id="group-chat">
                            <ul class="people no-padding-start">
                                <% getAllConversationWithMessages.forEach(function(e){ %>
                                    <% if(e.members) { %>
                                        <a href="#uid_<%= e._id %>" class="room-chat"  data-target="#to_<%= e._id %>" >
                                            <li class="person group-chat" data-chat="<%= e._id %>">
                                                <div class="left-avatar">
                                                    <!-- <div class="dot"></div> -->
                                                    <img src="images/users/group-avatar-trungquandev.png" alt="">
                                                </div>
                                                <span class="name">
                                                    <span class="group-chat-name">Group:</span> <%= e.name %>
                                                </span>
                                                <span class="time">
                                                    <%= convertTime(getLastItem(e.messages).createdAt) %>
                                                </span>
                                                <span class="preview convert-emoji">
                                                    <% if(getLastItem(e.messages).messageType==="text") { %>
                                                        <%= getLastItem(e.messages).text %>
                                                    <% } %>
                                                    <% if(getLastItem(e.messages).messageType==="image") { %>
                                                        Đã gửi một ảnh
                                                    <% } %>
                                                    <% if(getLastItem(e.messages).messageType==="file") { %>
                                                        Đã gửi một tệp đính kèm
                                                    <% } %>
                                                </span>
                                            </li>
                                        </a>
                                    <% } %>
                                <% }); %>
                            </ul>
                        </div>
                    </div>
                    
                </div>
            </div>

            <!-- include('sections/rightSidenav'); -->
            <div class="col-sm-9 sidenav no-padding">
                <div class="tab-content" id="screen-chat">
                    <% getAllConversationWithMessages.forEach(function(e, index){ %>
                        <% if(e.members) { %>
                        <div id="to_<%= e._id%>" class="right tab-pane  <% if(index === 0) { %> active <% } %>" data-chat="<%= e._id%>" >
                            <div class="top">
                                <span>To: <span class="name"><%= e.name %></span></span>
                                <span class="chat-menu-right">
                                    <a href="#attachsModal" id="show-attachs" data-toggle="modal">
                                        Tệp đính kèm
                                        <i class="fa fa-paperclip"></i>
                                    </a>
                                </span>
                                <span class="chat-menu-right">
                                    <a href="javascript:void(0)">&nbsp;</a>
                                </span>
                                <span class="chat-menu-right">
                                    <a href="#imagesModal" id="show-images" data-toggle="modal">
                                        Hình ảnh
                                        <i class="fa fa-photo"></i>
                                    </a>
                                </span>
                                <span class="chat-menu-right">
                                    <a href="javascript:void(0)">&nbsp;</a>
                                </span>
                                <span class="chat-menu-right">
                                    <a href="javascript:void(0)" id="number-members" data-toggle="modal">
                                        <span class="show-number-members"><%= e.userAmount %></span>
                                        <i class="fa fa-users"></i>
                                    </a>
                                </span>
                                <span class="chat-menu-right">
                                    <a href="javascript:void(0)">&nbsp;</a>
                                </span>
                                <span class="chat-menu-right">
                                    <a href="javascript:void(0)" id="number-messages" data-toggle="modal">
                                        <span class="show-number-messages"><%= e.messageAmount %></span>
                                        <i class="fa fa-comment-o"></i>
                                    </a>
                                </span>
                            </div>
                            <div class="content-chat">
                                <div class="chat" data-chat="<%= e._id%>">
                                    <% e.messages.forEach(function(mess){   %>
                                        <% if(mess.messageType === "text"){ %>
                                            <div class=" convert-emoji bubble <% if(mess.senderId == user._id) { %> me <% }
                                            else { %> you <% } %> " data-mess-id="<%=mess._id %>">
                                                <img src="/images/users/<%= mess.sender.avatar %>" 
                                                    class ="avatar-small" title ="<%= mess.sender.name %>" >
                                                <%= mess.text %>
                                            </div>
                                        <% } %>
                                        <% if(mess.messageType === "image"){ %>
                                            <div class="bubble <% if(mess.senderId == user._id) { %> me <% }
                                            else { %> you <% } %> bubble-image-file" data-mess-id="<%=mess._id %>">
                                                <img src="/images/users/<%= mess.sender.avatar %>" 
                                                    class ="avatar-small" title ="<%= mess.sender.name %>" >
                                                <img src="data: <%= mess.file.contentType %>; base64, <%= convert(mess.file.data) %>"
                                                   class="show-image-chat">
                                            </div>
                                        <% } %>
                                        <% if(mess.messageType === "file"){ %>
                                            <div class="bubble <% if(mess.senderId == user._id) { %> me <% }
                                            else { %> you <% } %> bubble-image-file" data-mess-id="<%=mess._id %>">
                                                <img src="/images/users/<%= mess.sender.avatar %>" 
                                                   class ="avatar-small" title ="<%= mess.sender.name %>" >
                                                <a href="data: <%= mess.file.contentType %>; base64, <%= convert(mess.file.data) %>" 
                                                   download="<%= mess.file.fileName %>">
                                                 <%= mess.file.fileName %>
                                                </a>
                                            </div>
                                        <% } %>
                                    <% }); %>
                                </div>
                            </div>
                            <div class="write" data-chat="<%=e._id %>">
                                <input type="text" class="write-chat chat-in-group" id="write-chat-<%=e._id %>" data-chat="<%=e._id %>">
                                <div class="icons">
                                    <a href="#" class="icon-chat" data-chat="<%=e._id %>"><i class="fa fa-smile-o"></i></a>
                                    <label for="image-chat">
                                        <input type="file" id="image-chat" name="my-image-chat" class="image-chat" data-chat="<%=e._id %>">
                                        <i class="fa fa-photo"></i>
                                    </label>
                                    <label for="attach-chat">
                                        <input type="file" id="attach-chat" name="my-attach-chat" class="attach-chat" data-chat="<%=e._id %>">
                                        <i class="fa fa-paperclip"></i>
                                    </label>
                                    <a href="#streamModal" id="video-chat" class="video-chat" data-chat="<%=e._id %>" data-toggle="modal">
                                        <i class="fa fa-video-camera"></i>
                                    </a>
                                    <input type="hidden" id="peer-id" value="">
                                </div>
                            </div>
                        </div>
                        <% } else { %>
                            <div id="to_<%= e._id%>" class="right tab-pane <% if(index === 0) { %> active <% } %>" data-chat="<%= e._id%>" >
                                <div class="top">
                                    <span>To: <span class="name"><%= e.username %></span></span>
                                    <span class="chat-menu-right">
                                        <a href="#attachsModal" id="show-attachs" data-toggle="modal">
                                            Tệp đính kèm
                                            <i class="fa fa-paperclip"></i>
                                        </a>
                                    </span>
                                    <span class="chat-menu-right">
                                        <a href="javascript:void(0)">&nbsp;</a>
                                    </span>
                                    <span class="chat-menu-right">
                                        <a href="#imagesModal" id="show-images" data-toggle="modal">
                                            Hình ảnh
                                            <i class="fa fa-photo"></i>
                                        </a>
                                    </span>
                                </div>
                                <div class="content-chat">
                                    <div class="chat" data-chat="<%= e._id%>">
                                        <% e.messages.forEach(function(mess){   %>
                                            <% if(mess.messageType === "text"){ %>
                                                <div class=" convert-emoji bubble <% if(mess.senderId == user._id) { %> me <% }
                                                else { %> you <% } %> " data-mess-id="<%=mess._id %>">
                                                    
                                                    <%= mess.text %>
                                                </div>
                                            <% } %>
                                            <% if(mess.messageType === "image"){ %>
                                                <div class="bubble <% if(mess.senderId == user._id) { %> me <% }
                                                else { %> you <% } %> bubble-image-file" data-mess-id="<%=mess._id %>">
                                                   
                                                    <img src="data: <%= mess.file.contentType %>; base64,<%= convert(mess.file.data) %>"
                                                     class="show-image-chat">
                                                </div>
                                            <% } %>
                                            <% if(mess.messageType === "file"){ %>
                                                <div class="bubble <% if(mess.senderId == user._id) { %> me <% }
                                                else { %> you <% } %> bubble-image-file" data-mess-id="<%=mess._id %>">
                                                   
                                                    <a href="data: <%= mess.file.contentType %>; base64,<%= convert(mess.file.data) %>" 
                                                    download="<%= mess.file.fileName %>">
                                                     <%= mess.file.fileName %>
                                                    </a>
                                            </div>
                                            <% } %>
                                        <% }); %>
                                    </div>
                                </div>
                                <div class="write" data-chat="<%=e._id %>">
                                    <input type="text" class="write-chat" id="write-chat-<%=e._id %>" data-chat="<%=e._id %>">
                                    <div class="icons">
                                        <a href="#" class="icon-chat" data-chat="<%=e._id %>"><i class="fa fa-smile-o"></i></a>
                                        <label for="image-chat">
                                            <input type="file" id="image-chat" name="my-image-chat" class="image-chat" data-chat="<%=e._id %>">
                                            <i class="fa fa-photo"></i>
                                        </label>
                                        <label for="attach-chat">
                                            <input type="file" id="attach-chat" name="my-attach-chat" class="attach-chat" data-chat="<%=e._id %>">
                                            <i class="fa fa-paperclip"></i>
                                        </label>
                                        <a href="#streamModal" id="video-chat" class="video-chat" data-chat="<%=e._id %>" data-toggle="modal">
                                            <i class="fa fa-video-camera"></i>
                                        </a>
                                        <input type="hidden" id="peer-id" value="">
                                    </div>
                                </div>
                                
                            </div>
                        <% } %>
                    <% }); %>
                </div>
               
                <!-- Trường hợp tài khoản chưa có bạn bè thì hiện màn hình dưới. -->
                
            </div>
        </div>
    </div>

    <!--Libraries-->
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
    <script src="bower_components/jquery.nicescroll/jquery.nicescroll.min.js"></script>
    <script src="bower_components/AlertifyJS/build/alertify.js"></script>
    <script src="bower_components/moment/min/moment.min.js"></script>
    <script src="bower_components/moment/min/moment-with-locales.min.js"></script>
    <script src="bower_components/emojionearea/dist/emojionearea.min.js"></script>
    <script src="bower_components/peerjs/peer.min.js"></script>
    <script src="bower_components/sweetalert2/dist/sweetalert2.all.min.js"></script>
    <script src="bower_components/photoset-grid/jquery.photoset-grid.min.js"></script>
    <script src="bower_components/jquery-colorbox/jquery.colorbox-min.js"></script>
    <script src="bower_components/emojione/lib/js/emojione.min.js"></script>
    <script src="socket.io/socket.io.js"></script>
    <!-- My js-->
    <script src="js/mainConfig.js"></script>
    <script src="js/updateUser.js"></script>
    <script src="js/addContact.js"></script>
    <script src="js/removeContact.js"></script>
    <script src="js/removeContactReceived.js"></script>
    <script src="js/approveRequestContactReceived.js"></script>
    <script src="js/removeFriend.js"></script>
    <script src="js/findUsersContact.js"></script>
    <script src="js/textAndEmoji.js"></script>
    <script src="js/caculteNumberMessage.js"></script>

    <!-- include('../contacts/contactsModal'); -->
    <div class="modal fade" id="contactsModal" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Quản lý liên lạc</h4>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs">
                        <li class="active"><a data-toggle="tab" href="#find-user">Tìm người dùng</a></li>
                        <li><a data-toggle="tab" id="link-contacts" href="#contacts">
                            Danh bạ 
                            <% if(countAllContactss > 0) { %>
                                <span class="show-number-contacts count-contacts">
                                    (<em><%= countAllContactss %></em>)
                                </span>
                            <% } else { %>
                                <span class="show-number-contacts count-contacts ">
                                </span>
                            <% } %>
                            
                        </a></li>
                        <li><a data-toggle="tab" id="link-request-contact-sent" href="#request-contact-sent">
                            Đang chờ xác nhận 
                            <% if(countAllContactsSents > 0) { %>
                                <span class="show-number-contacts count-request-contact-sent">
                                    (<em><%=countAllContactsSents %></em>)
                                </span>
                            <% } else { %>
                                <span class="show-number-contacts count-request-contact-sent ">
                                </span>
                            <% } %>
                            
                        </a></li>
                        <li><a data-toggle="tab" id="link-request-contact-received" href="#request-contact-received">
                            Yêu cầu kết bạn 
                            <% if(countAllContactsReceiveds > 0) { %>
                                <span class="show-number-contacts count-request-contact-received">
                                    (<em><%= countAllContactsReceiveds %></em>)
                                </span>
                            <% } else { %>
                                <span class="show-number-contacts count-request-contact-received ">
                                </span>
                            <% } %>
                           
                        </a></li>
                    </ul>
                    <div class="tab-content">
                        <div id="find-user" class="tab-pane fade in active">
                            <div class="find-user-top">
                                <div class="input-group col-md-12">
                                    <input type="text" id="input-find-users-contact" class="form-control" placeholder="Nhập E-mail hoặc username..." />
                                    <span class="input-group-btn">
                                        <button id="btn-find-users-contact" class="btn btn-lg" type="button">
                                            <i class="glyphicon glyphicon-search"></i>
                                        </button>
                                    </span>
                                </div>
                            </div>
                            <div class="find-user-bottom">
                                <ul class="contactList">
                                   
                                </ul>
                            </div>
                        </div>
                        <div id="contacts" class="tab-pane fade">
                            <div class="find-user-bottom">
                                <ul class="contactList">
                                    <% contacts.forEach((e) => { %>
                                        <li class="_contactList" data-uid=" <%= e._id %>">
                                            <div class="contactPanel">
                                                <div class="user-avatar">
                                                    <img src="images/users/<%=e.avatar%>" alt="">
                                                </div>
                                                <div class="user-name">
                                                    <p>
                                                        <%= e.username %>
                                                    </p>
                                                </div>
                                                <br>
                                                <div class="user-address">
                                                    <span>&nbsp <%= e.address %></span>
                                                </div>
                                                <div class="user-talk" data-uid="<%= e._id %>">
                                                    Trò chuyện
                                                </div>
                                                <div class="user-remove-contact action-danger" data-uid="<%= e._id %>">
                                                    Xóa liên hệ
                                                </div>
                                            </div>
                                        </li>
                                    <% }); %>
                                    
                                </ul>
                            </div>
                        </div>
                        <div id="request-contact-sent" class="tab-pane fade">
                            <div class="find-user-bottom">
                                <ul class="contactList">
                                    <% contactsSent.forEach((e) => { %>
                                        <li class="_contactList" data-uid="<%= e._id %>">
                                            <div class="contactPanel">
                                                <div class="user-avatar">
                                                    <img src="images/users/<%= e.avatar %>" alt="">
                                                </div>
                                                <div class="user-name">
                                                    <p>
                                                        <%= e.username %>
                                                    </p>
                                                </div>
                                                <br>
                                                <div class="user-address">
                                                    <span>&nbsp <%= e.address %></span>
                                                </div>
                                                <div class="user-remove-request-contact display-important action-danger" data-uid="<%= e._id %>">
                                                    Hủy yêu cầu
                                                </div>
                                            </div>
                                        </li>
                                 <% }); %>
                                    
                                </ul>
                            </div>
                        </div>
                        <div id="request-contact-received" class="tab-pane fade">
                            <div class="find-user-bottom">
                                <ul class="contactList">
                                    <% contactsReceived.forEach((e) => { %>
                                        <li class="_contactList" data-uid="<%= e._id %>">
                                            <div class="contactPanel">
                                                <div class="user-avatar">
                                                    <img src="images/users/<%= e.avatar %>" alt="">
                                                </div>
                                                <div class="user-name">
                                                    <p>
                                                        <%= e.username %>
                                                    </p>
                                                </div>
                                                <br>
                                                <div class="user-address">
                                                    <span>&nbsp <%= e.address %></span>
                                                </div>
                                                <div class="user-approve-request-contact-received" data-uid="<%= e._id %>">
                                                    Chấp nhận
                                                </div>
                                                <div class="user-remove-request-contact-received action-danger" data-uid="<%= e._id %>">
                                                    Xóa yêu cầu
                                                </div>
                                            </div>
                                        </li>
                                    <% }); %>
                                    
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- include('../stream/streamModal'); -->
    <div class="modal fade" id="streamModal" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Streaming Video & Audio</h4>
                </div>
                <div class="modal-body">
                    <video id="remote-stream" width="500" controls style="margin-left: 20%;"></video>
                    <br><br>
                    <video id="local-stream" width="170" controls style="margin-left: 20%;"></video>
                    <br><br>
                </div>
            </div>
        </div>
    </div>    

    <!-- include('../images/imagesModal'); -->
    <div class="modal fade" id="imagesModal" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">All Images in this conversation.</h4>
                </div>
                <div class="modal-body">
                    <div class="all-images" style="visibility: hidden;">
                        <img src="images/users/tiepnguyen.jpg">
                        <img src="images/users/tiepnguyen.jpg">
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- include('../attachs/attachsModal'); -->
    <div class="modal fade" id="attachsModal" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">All Attachs in this conversation.</h4>
                </div>
                <div class="modal-body">
                    <ul class="list-attachs">
                        <li>
                            <a href="fileExample/Tệp văn bản - trungquandev.pdf" 
                            download="${ item.file.fileName }">
                                Tệp văn bản - tiepnguyen.pdf
                            </a>
                        </li>
                        <li>
                            <a href="fileExample/Tệp văn bản - trungquandev.docx" 
                            download="${ item.file.fileName }">
                                Tệp văn bản - tiepnguyen.docx
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
        
    <!-- include('../users/profileModal'); -->
    <div class="modal fade" id="user-profile-modal" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Tài khoản cá nhân</h4>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs">
                        <li class="active"><a data-toggle="tab" href="#seting-profile">Cài đặt chung</a></li>
                        <li><a data-toggle="tab" id="link-to-password-profile" href="#password-profile">Quản lý mật khẩu</a></li>
                    </ul>
                    <div class="tab-content">
                        <div id="seting-profile" class="tab-pane fade in active">
                            <div class="row">
                                <form class="form-horizontal" method="post" role="form" action="">
                                    <!-- left column -->
                                    <div class="col-md-3">
                                        <div class="text-center" id="div-update-avatar">
                                            <div id="image-edit-profile">
                                                <img src="images/users/<%= user.avatar%>" id="user-modal-avatar" class="avatar img-circle" alt="avatar">
                                            </div>
                                            <h6>Tải lên một ảnh mới...</h6>
                                            <input type="file" class="form-control" id="input-change-avatar" name="avatar"><br>
                                            <div id="show-button-update-avatar"></div>
                                        </div>
                                    </div>
                                    <!-- edit form column -->
                                    <div class="col-md-9 personal-info">
                                        <div class="alert alert-danger alert-dismissable user-modal-alert-error">
                                            <a class="panel-close close" data-dismiss="alert">×</a>
                                            <span>Update user error example.</span>
                                            <!-- <script>openProfileModal();</script> -->
                                        </div>
    
                                        <div class="alert alert-success alert-dismissable user-modal-alert-success">
                                            <a class="panel-close close" data-dismiss="alert">×</a>
                                            <span>Update user success example.</span>
                                            <!-- <script>openProfileModal();</script> -->
                                        </div>

    
                                        <br>
                                        <div class="form-group">
                                            <label class="col-lg-3 control-label">Email:</label>
                                            <div class="col-lg-8">
                                                <div class="form-control" disabled><%= user.local.email %></div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-3 control-label">Username:</label>
                                            <div class="col-md-8">
                                                <input id="input-change-username" class="form-control" type="text" name="username" value="<%= user.username%>">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-lg-3 control-label">Giới tính:</label>
                                            <div class="col-lg-8">
                                                <label class="radio-inline col-lg-2">Nam
                                                    <input id="input-change-gender-male" type="radio" name="gender" value="male" <% if(user.gender === "male" ) { %> checked  <% } %> required>
                                                    <span class="checkmark"></span>
                                                </label>
                                                <label class="radio-inline col-lg-2">Nữ
                                                    <input id="input-change-gender-female" type="radio" name="gender" value="female" <% if(user.gender === "female" ) { %> checked  <% } %> required>
                                                    <span class="checkmark"></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-lg-3 control-label">Địa chỉ:</label>
                                            <div class="col-lg-8">
                                                <input id="input-change-address" class="form-control" type="text" name="address" value="<%= user.address%>">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-lg-3 control-label">Số điện thoại:</label>
                                            <div class="col-lg-8">
                                                <input id="input-change-phone" class="form-control" type="text" name="phone" value="<%= user.phone%>">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-3 control-label"></label>
                                            <div class="col-md-8">
                                                <input type="button" id="input-btn-update-user" class="btn btn-primary custom-background-btn-primary" name="submit" value="Lưu lại">
                                                <span></span>
                                                <input type="reset" id="input-btn-cancel-update-user" class="btn btn-default custom-background-btn-reset" value="Hủy bỏ">
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div id="password-profile" class="tab-pane fade">
                            <br/>
                            <div class="col-md-9 personal-info">
                                <div class="alert alert-danger alert-dismissable user-modal-password-alert-error">
                                    <a class="panel-close close" data-dismiss="alert">×</a>
                                    <span>Update user error example.</span>
                                    <!-- <script>openProfileModal();</script> -->
                                </div>

                                <div class="alert alert-success alert-dismissable user-modal-password-alert-success">
                                    <a class="panel-close close" data-dismiss="alert">×</a>
                                    <span>Update user success example.</span>
                                    <!-- <script>openProfileModal();</script> -->
                                </div>

                                <h3>Thay đổi mật khẩu</h3>
                                <br>
                                <form class="form-horizontal" method="post" role="form" action="">
                                    <div class="form-group">
                                        <label class="col-md-4 control-label">Mật khẩu cũ</label>
                                        <div class="col-md-8">
                                            <input id="input-change-current-password" class="form-control" type="password" name="current_password" placeholder="Enter your curent password...">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-md-4 control-label">Mật khẩu mới</label>
                                        <div class="col-md-8">
                                            <input id="input-change-new-password" class="form-control" type="password" name="new_password" placeholder="Enter new password...">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-md-4 control-label">Nhập lại mật khẩu mới</label>
                                        <div class="col-md-8">
                                            <input id="input-change-new-confirm-password" class="form-control" type="password" name="confirm_new_password" placeholder="Enter confirm new password...">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-md-4 control-label"></label>
                                        <div class="col-md-8">
                                            <input type="button" id="input-btn-update-user-password" class="btn btn-primary custom-background-btn-primary" value="Lưu lại">
                                            <span></span>
                                            <input type="reset" id="input-btn-cancel-update-user-password" class="btn btn-default custom-background-btn-reset" value="Hủy bỏ">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- include('../groupChat/groupChatModal'); -->
    <div class="modal fade" id="groupChatModal" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Tạo một nhóm trò chuyện mới.</h4>
                </div>
                <div class="modal-body">
                    <div class="col-md-5 col-sm-12 find-user-add-to-group">
                        <div class="row form-search-to-add">
                            <div class="form-group">
                                <input type="text" class="form-control" id="btn-search-friend-to-add-group-chat" placeholder="Nhập E-mail hoặc username của bạn bè..." />
                                <span class="input-group-btn">
                                    <button class="btn btn-lg" type="button">
                                        <i class="glyphicon glyphicon-search"></i>
                                    </button>
                                </span>
                            </div>
                        </div>
                        <div class="row result-searched">
                            <ul id="group-chat-friends">
                                <div data-uid="test-uid-01">
                                    <li data-uid="test-uid-01">
                                        <div class="contactPanel">
                                            <div class="user-avatar">
                                                <img src="images/users/avatar-default.jpg" alt="">
                                            </div>
                                            <div class="user-name">
                                                <p>
                                                    Tiệp Nguyễn
                                                </p>
                                            </div>
                                            <br>
                                            <div class="user-address">
                                                <span>&nbsp Hà Nội, Việt Nam</span>
                                            </div>
                                            <div class="add-user" data-uid="test-uid-01">
                                                Thêm vào nhóm
                                            </div>
                                        </div>
                                    </li>
                                </div>
                                <div data-uid="test-uid-02">
                                    <li data-uid="test-uid-02">
                                        <div class="contactPanel">
                                            <div class="user-avatar">
                                                <img src="images/users/tiepnguyen.jpg" alt="">
                                            </div>
                                            <div class="user-name">
                                                <p>
                                                    Tiệp Nguyễn
                                                </p>
                                            </div>
                                            <br>
                                            <div class="user-address">
                                                <span>&nbsp Hà Nội, Việt Nam</span>
                                            </div>
                                            <div class="add-user" data-uid="test-uid-02">
                                                Thêm vào nhóm
                                            </div>
                                        </div>
                                    </li>
                                </div>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-5 col-sm-12 list-user-added">
                        <ul id="friends-added"></ul>
                        <div class="text-center" id="action-create-name-chat">
                            <input type="text" class="form-control" id="name-group-chat" placeholder="Nhập tên nhóm trò chuyện..." />
                            <br>
                            <button type="button" class="btn btn-primary" id="create-group-chat">Tạo</button>
                            <button type="button" class="btn btn-danger" id="cancel-group-chat">Hủy</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
